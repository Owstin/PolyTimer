<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PolyTimer</title>

    <link rel="shortcut icon" type="image/png" href="img/favicon-96x96.png"/>

    <link rel="stylesheet" type="text/css" href="css/style.css" title="default">
    <link rel="alternate stylesheet" type="text/css" href="css/light.css" title="light">
    <link rel="alternate stylesheet" type="text/css" href="css/ocean.css" title="ocean">
    <link rel="alternate stylesheet" type="text/css" href="css/ccff00.css" title="ccff00">

    <script type="text/javascript" src="js/styleswitcher.js"></script>

    <!--standard scrambles-->
    <script src="jsss-master/scramble_222.js"></script>
    <script src="jsss-master/scramble_333.js"></script>
    <script src="jsss-master/scramble_NNN.js"></script>

    <!--other scrambles-->
    <script src="jsss-master/scramble_minx.js"></script>
    <script src="jsss-master/scramble_pyram.js"></script>
    <script src="jsss-master/scramble_sq1.js"></script>
    <script src="jsss-master/scramble_clock.js"></script>

    <script>
        function clearSolves() {
            if (confirm("Really delete all of your saved data?") == true) {
                localStorage.clear();
                window.location.reload(true);
            }
        }

        function updateThemeBox() {
            var selectBox = document.getElementById("selectBoxTheme");
            selectBox.value = getActiveStyleSheet();
        }

        function updateScrambleBox() {
            var selectBox = document.getElementById("selectBoxScramble");

            if (localStorage.getItem("scrambleType") === null) {
                selectBox.value = "333";
            } else {
                selectBox.value = JSON.parse(localStorage.getItem("scrambleType"));
            }
        }

        function updateSession() {
            var selectBox = document.getElementById("sessionSelect");
            
            if (currentSession > 1 && !selectBox.options[currentSession]) {
                selectBox.add(new Option('Session ' + currentSession, currentSession));
            }

            if (localStorage.getItem("currentSession") === null) {
                selectBox.value = "1";
            } else {
                selectBox.value = JSON.parse(localStorage.getItem("currentSession"));
            }
        }

        function changeSession() {
            var selectBox = document.getElementById("sessionSelect");

            if (selectBox.value == "new") {
                sessions.push();
                currentSession = sessions.length;
            } else {
                currentSession = Number(selectBox.value);
            }
            
            localStorage.setItem("sessions", JSON.stringify(sessions));
            localStorage.setItem("currentSession", JSON.stringify(currentSession));

            window.location.reload(true);
        }

        function changeTheme() {
            var selectBox = document.getElementById("selectBoxTheme");
            var theme = selectBox.value;

            setActiveStyleSheet(theme);
            window.location.reload(true);
        }

        function changeScramble() {
            var selectBox = document.getElementById("selectBoxScramble");
            var selectedVal = selectBox.options[selectBox.selectedIndex].value;

            scrambleType = selectedVal;
            localStorage.setItem("scrambleType", JSON.stringify(scrambleType));
            window.location.reload(true);
        }

        function timeFormatter(s) {
            var ms = s % 1000;
            s = (s - ms) / 1000;
            var secs = s % 60;
            s = (s - secs) / 60;
            var mins = s % 60;
            var hrs = (s - mins) / 60;

            ms = Math.round(ms/10);

            if (hrs > 0) {

            } else {
                if (mins > 0) {
                    if (secs < 10) {
                        if (ms < 10) {
                            return mins + ':0' + secs + '.0' + ms;
                        } else {
                            return mins + ':0' + secs + '.' + ms;
                        }
                    } else {
                        if (ms < 10) {
                            return mins + ':' + secs + '.0' + ms;
                        } else {
                            return mins + ':' + secs + '.' + ms;
                        }
                    }
                } else {
                    if (ms < 10) {
                        return secs + '.0' + ms;
                    } else {
                        return secs + '.' + ms;
                    }
                }
            }
        }
    </script>
</head>

<body onload="updateScrambleBox(); updateThemeBox(); updateSession();">
    <div id="container">
        <div id="topBar">
            <span id="menuButton">&#9776;</span>
            <span id="logoText">PolyTimer</span><span style="font-size: 10pt;">&nbsp;&nbsp;Beta</span>
        </div>
        <div id="fillerBar"></div>
        <div id="leftBlock">
            <table id="solvesTable">
                <tr id="headerTr">
                    <td id="solvesTd">#</td>
                    <td id="solvesTd">solve time</td>
                    <td id="solvesTd">ao5</td>
                    <td id="solvesTd">ao12</td>
                </tr>
                <script>
                    //Open the session that was last used if it exists
                    if (localStorage.getItem("currentSession") === null) {
                        currentSession = "1";
                    } else {
                        currentSession = JSON.parse(localStorage.getItem("currentSession"));
                    }

                    //update the sessions array if it's in local storage
                    if (localStorage.getItem("sessions") === null) {
                        var sessions = [solves];
                        sessions.push("blank");
                    } else {
                        var sessions = JSON.parse(localStorage.getItem("sessions"));
                    }

                    //update the solves/ao5s/ao12s arrays if they're in local storage
                    if (localStorage.getItem("solves") === null) {
                        var solves = [];
                        var ao5s = [];
                        var ao12s = [];
                    } else {
                        //var solves = JSON.parse(localStorage.getItem("solves"));
                        if (sessions[currentSession]) {
                            var solves = sessions[currentSession];
                        } else {
                            var solves = [];
                        }
                        var ao5s = JSON.parse(localStorage.getItem("ao5s"));
                        var ao12s = JSON.parse(localStorage.getItem("ao12s"));
                    }
                    
                    var tableContents = '';

                    for (i = solves.length; i--;) {
                        var timeFormatted = timeFormatter(solves[i]);
                        var timeFloated = parseFloat(timeFormatted).toFixed(2);

                        var ao5Formatted = timeFormatter(ao5s[i]);
                        var ao5Floated = parseFloat(ao5Formatted).toFixed(2);

                        var ao12Formatted = timeFormatter(ao12s[i]);
                        var ao12Floated = parseFloat(ao12Formatted).toFixed(2);
                        
                        tableContents += '<tr id="solvesTr"><td id="solvesTd">' + (i+1) + '</td>';

                        //solves
                        if (timeFormatted.includes(":")) {
                            tableContents += '<td id="solvesTd">' + timeFormatted + '</td>';
                        } else {
                            tableContents += '<td id="solvesTd">' + timeFloated + '</td>';
                        }

                        //ao5
                        if (ao5Formatted.includes(":")) {
                            tableContents += '<td id="solvesTd">' + ao5Formatted + '</td>';
                        } else {
                            tableContents += '<td id="solvesTd">' + ao5Floated + '</td>';
                        }

                        //ao12
                        if (ao12Formatted.includes(":")) {
                            tableContents += '<td id="solvesTd">' + ao12Formatted + '</td></tr>';
                        } else {
                            tableContents += '<td id="solvesTd">' + ao12Floated + '</td></tr>';
                        }
                    }

                    document.write(tableContents);
                </script>
            </table>
        </div>

        <div id="rightBlock">
            <div id="timerDiv">
                <div id="timerElements">
                    
                    <h1 id="timer">0.00</h1>
                    <span id="scramble"></span>
                    <script src="js/timer.js"></script>
                    <script src="js/main.js"></script>
                </div>
            </div>

            <div id="discordButton">
                <a target="_blank" href="https://discord.gg/UpN7pXf"><img src="img/Discord-Logo-White.PNG" height="64" width="64"></a>
            </div>
        </div>
    </div>

    <!--settings menu stuff below-->
    <div id="settingsMenu" class="modal">
        <!-- Modal content -->
        <div class="modal-content">

            <button class="collapsible">Timer / Sessions</button>
            <div class="collapseContent">
                <div class="modal-body">
                    <br>
                    <table>
                        <tr>
                            <td style="padding: 2px">Session: </td>
                            <td style="padding: 2px">
                            <select id="sessionSelect" onchange="changeSession()">
                                <option value="new">New Session</option>
                                <script>
                                var options = '';
                
                                for (var i = 0; i < sessions.length-1; i++) {
                                    var index = sessions[i+1];
                
                                    if (index !== "deleted") {
                                        options += '<option value=\"' + (i+1) + '\">Session ' + (i+1) + '</option>';
                                    }
                                }
                
                                document.write(options);
                                </script>
                            </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 2px; width: 75px;">Scramble:</td>
                            <td style="padding: 2px;">
                            <select id="selectBoxScramble" onchange="changeScramble()">
                                <option value="222">2x2</option>
                                <option value="333" selected="selected">3x3</option>
                                <option value="444">4x4</option>
                                <option value="555">5x5</option>
                                <option value="666">6x6</option>
                                <option value="777">7x7</option>
                                <option value="333bf">3x3 BLD</option>
                            </select>
                            </td>
                        </tr>
                    </table>
                    <div style="padding: 2px;">
                        <p>Controls:</p>
                        <p><b>Start/Stop the timer:</b> Space bar</p>
                        <p><b>Delete the last solve:</b> Backspace</p>
                        <p><b>Last scramble:</b> Left arrow key</p>
                        <p><b>Next scramble:</b> Right arrow key</p>
                    <br>
                    <a id="clearLink" onclick="clearSolves()">[CLEAR ALL SAVED DATA]</a>
                    </div>
                    <br>
                </div>
            </div>

            <button class="collapsible">Look & Feel</button>
            <div class="collapseContent">
                <div class="modal-body">
                    <br><table>
                        <tr>
                            <td style="padding: 2px; width: 75px;">Theme:</td>
                            <td style="padding: 2px;">
                                <select id="selectBoxTheme" onchange="changeTheme()">
                                    <option value="default" selected="selected">Dark</option>
                                    <option value="light">Light</option>
                                    <option value="ocean">Ocean</option>
                                    <option value="ccff00">#CCFF00</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                    <table>
                        <tr>
                            <td style="padding: 2px;"><input type="checkbox" id="selectBoxTheme" checked disabled></td><td style="padding: 2px;"> Show time while solving?</td>
                        </tr>
                    </table><br>
                </div>
            </div>

            <button class="collapsible">Extras</button>
            <div class="collapseContent">
                <div class="modal-body">
                    <p>If you'd like to request any features or report bugs, join the Discord!<br><br><a id="clearLink" href="https://discord.gg/UpN7pXf">discord.gg/UpN7pXf</a></p>
                    <hr>
                    <p><a id="clearLink" target="_blank" href="todo.txt">> Upcoming features</a><br>
                    <a id="clearLink" target="_blank" href="knownbugs.txt">> Known bugs</a></p>
                    <hr>
                    <table>
                        <tr style="font-weight: bold;"><td>Special thanks to...</td></tr>
                        <tr><td>Rouxles</td></tr>
                        <tr><td>Kleb</td></tr>
                        <tr><td>Flowery Dragon</td></tr>
                        <tr><td>Xetni14</td></tr>
                        <tr><td>Cubing_Cuber</td></tr>
                        <tr><td>Niccbudd</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

        <script>
        // Get the modal
        var modal = document.getElementById('settingsMenu');
        
        // Get the button that opens the modal
        var menuButton = document.getElementById("menuButton");
        
        // When the user clicks the button, open the modal 
        menuButton.onclick = function() {
            if (settingsOpen == true) {
                settingsOpen = false;
                modal.style.display = "none";
            } else {
                settingsOpen = true;
                modal.style.display = "flex";
            }
        }
    </script>

    <script>
        var coll = document.getElementsByClassName("collapsible");
        var i;

        for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight){
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
            });
        }
    </script>
</body>

</html>